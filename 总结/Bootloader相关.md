# BIOS：
    即基本输入输出系统，它是一组固化到计算机内主板上的一个ROM芯片上的程序，他保存着计算机最重要的基本输入输出程序、开机自检程序和系统自启动程序。
**功能** ：负责启动、初始化计算机硬件、引导操作系统启动
# MBR:
    主引导记录，也被称为主引导扇区，是计算机开机以后访问硬盘时所必须要读取的第一个扇区，位于硬盘的第一物理扇区。由于历史原因，硬盘的一个扇区大小是512字节，包含最多446字节的启动代码、4个硬盘分区表项（每个表项16字节，共64字节）、2个签名字节（0x55,0xAA）
# Bootloader：
    Bootloader是在操作系统运行之前执行的一段小程序。通过这段小程序，我们可以初始化硬件设备、建立内存空间的映射表，从而建立适当的系统软硬件环境，为最终调用操作系统内核做好准备。
# U-Booot
    U-Boot 是一个主要用于嵌入式系统的引导加载程序，可以支持多种不同的计算机系统结构，包括PPC、ARM、AVR32、MIPS、x86、68k、Nios与MicroBlaze。

# 嵌入式开发流程
   ## 需求分析
   - 与客户沟通，确定产品的功能需求、性能需求、编写设计说明书
   ## 系统设计
   - 硬件设计：选择适当的硬件，如芯片、cpu、板子等
   -  软件设计：操作系统的选择、驱动程序的开发等
   ## 软件编码开发
   - 编写程序，功能模块代码编写、系统构建、驱动程序编写等
   ## 系统集成
   - 将开发好的软件和硬件进行集成，确保软件和硬件可正常协调工作
   - 将编译的内核映像烧录到开发板
   ## 测试
   - 对系统进行全面的测试，包括功能测试、性能测试、稳定性测试等
# 嵌入式系统的启动流程
  ## 系统上电
  ## ROM程序加载第一段bootloader，并执行它
    - ROM程序从eMMC、Flash、SD等找到第一段bootloader，并加载到SRAM中执行
  ## 执行Bootloader(两个阶段)
   **cpu执行存储在Flash或ROM中的第一段Bootloader程序**
   - 1.负责初始化硬件设备，如CPU寄存器、Flash、DDR等，
   - 2.为加载第二段bootloader程序准备RAM空间
   - 3.将第二段bootloader加载到SDRAM中
   - 4.跳转到第二段bootloader程序的入口地址，将控制权交给第二段bootloader程序
   **执行第二段bootloader**
   - 初始化本阶段用到的硬件设备
   - 建立内存映射
   - 将内核映像和根文件系统映像从Flash加载到RAM中(也加载DTB到RAM中)
   - 为内核设置启动参数，引导Linux内核启动
   ## 内核启动
   - 挂载根文件系统
   - 查找根文件系统中是否含有init文件，并执行init程序
   - init程序负责系统初始化、启动系统服务等
   - 挂载其他文件系统
# bootrom、bootloader、kernel、rootfs存放位置
## bootrom
- 通常存储在只读存储器(ROM)中，一旦写入便很难更改
- BootROM是最早被执行的代码，用于初始化硬件并加载和启动操作系统或引导加载程序（Bootloader）
## bootloader
- 通常存储在非易失性存储器，如Flash、eMMC等
## kernel
- 可存储在外部存储设备，如硬盘
- eMMC的user data分区
## rootfs
- 可以是内存中的临时文件系统；也可是磁盘上的文件系统，存储在Flash、SD卡等


##

# 计算机系统启动（BIOS+MBR方式启动）
**启动可分为6个阶段**
- CPU上电
- BIOS硬件检测
- BIOS更新参数
- BIOS交出控制权
- 执行MBR引导程序
- 主引导程序加载系统
### （1）CPU上电：
 - 按下开机键，电源开始给主板和其他器件供电，CPU开始初始化
 - CPU开始从BIOS程序处执行
### （2）BIOS硬件检测
 - BIOS检测系统中的关键器件是否正常，比如内存、显卡
 - BIOS找到显卡后，调用显卡上初始化代码，完成显卡的初始化
 - BIOS逐一查找主板上的其他器件，看是否存在
 - BIOS显示自己的启动画面
### （3）BIOS更新参数
 - BIOS完成硬件检测后，会去更新ESCD(Extended System Configuration Data，扩展系统配置数据)
 - 实际是系统硬件配置发生变化才会去更新
### （4）BIOS交出控制权
 - BIOS执行完ESCD更新操作后，BIOS会依次查找磁盘、光盘、优盘等设备上是否有操作系统
 - 探测到存储设备后，将启动控制权交给MBR分区上的引导程序
### （5）执行MBR引导程序（Bootloader）
#### Bootloader第一阶段的功能
   - 硬件设备初始化
   - 为加载Bootloader的第二段主引导程序准备RAM空间（初始化内存空间）
   - 复制Bootloader的第二阶段代码到SDRAM空间中
   - 跳转到第二阶段代码的入口点，将控制权交给第二段主引导程序
#### Bootloader第二阶段的功能
   - 初始化本阶段要使用到的硬件设备
   - 检测系统内存映射：即确定板子上使用了多少内存，他们的地址空间是什么。
   - 将内核映像和根文件系统映像从Flash读到SDRAM空间中
   - 为内核设置启动参数
   - 调用linux内核，引导内核启动
 ### （6）Bootloader加载操作系统
 ## U-boot源码各目录用途
 |  目录 |    含义    |     用途    |
 | ----- |------------|------------|
 |/api|存放uboot提供的接口函数|提供功能函数接口|
 |/arch|包含了针对不同处理器架构的特定代码和配置文件|提供特定于处理器架构的初始化代码、汇编代码和函数确保u-boot能够在不同架构的处理器上运行|
 |/board|包含各种嵌入式开发板的配置文件和支持代码，每个开发板通常有一个对应的子目录|存放与特定硬件平台相关的配置和初始化代码|
|/boot|包含了与启动过程相关的代码|提供自加载程序，确保u-boot能够正确的加载和初始化系统|
|/common|存放通用的启动和初始化代码|这些代码可能会在多个不同的硬件平台上使用，提供共通的初始化逻辑和功能|
|/command|包含了u-boot提供的命令行命令的实现|例如，bootcmd.c包含了启动命令的默认实现，允许用户通过命令行进行设备配置、调试等操作|
|/configs|包含了针对特定硬件平台的配置文件(如.config文件)|这些配置文件保存了配置选项，用于构建过程中生成.config文件，指导u-boot的编译和配置|
|/drivers|存放设备驱动程序的代码|支持各种外设和接口，如串口、网络、存储等，确保u-boot能够与这些设备正确交互|
|/fs|包含了文件系统相关的代码|支持不同的文件系统类型，如ext4、fat、ubifs等，以便u-boot能够访问和加载存储在文件系统上的文件|
|/include|包含了u-boot项目中使用的所有头文件|定义了数据结构、函数原型和配置选项，为其他目录中的代码提供必要的声明和定义|
|/lib|存放函数库代码|如字符串处理、函数运算、缓存操作等通用函数，为u-boot提供基础的支持库|
|/post|包含内存测试和电源管理相关的代码|在u-boot启动过程中进行必要的硬件测试，确保系统稳定性和可靠性|
|/scripts|包含了构建系统使用的脚本|如kconfig配置文件和Makefile，用于指导u-boot的构建过程|
|/tools|存放了一些辅助工具|如为特定硬件平台生成配置文件的工具，帮助用户更方便的配置和编译u-boot|
|/examples|包含了示例代码|用于演示如何使用u-boot的某些特性，帮助用户理解和扩展u-boot的功能|
|/doc|包含u-boot的文档|包括使用手册、开发指南等，为用户提供详细的参考和指导|
|/disk|包含了与磁盘和存储设备相关的代码|支持u-boot对磁盘和存储设备的操作，如读取、写入等|
|/net|包含了网络相关的代码|实现网络协议栈，支持网络启动、文件传输等功能|
|/env|包含了环境变量相关的代码|这些变量用于存储配置和状态信息，允许用户通过环境变量来配置u-boot的行为|
|/test|包含了测试代码和测试脚本|用于对u-boot的动能进行测试，确保u-boot的稳定性和可靠性|