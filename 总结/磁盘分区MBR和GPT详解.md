# 硬盘结构
## 结构
> 硬盘由多个盘片叠在一起组成，每个盘片都有一个旋转轴心。盘片表面涂有磁性介质，用于存储数据。每个盘片的两侧都可以存储数据，因此一个硬盘的磁头数通常是盘片数的两倍（如果每面都有一个磁头的话）。

![alt text](https://img2020.cnblogs.com/blog/1776217/202012/1776217-20201206000639342-148768022.png)
![alt text](https://ts1.cn.mm.bing.net/th/id/R-C.48b45275146561cb0a551ad24394824f?rik=qrb73MC9DrfhIg&riu=http%3a%2f%2fwww.tong-pao.com%2fuploads%2fimage%2f20210720%2f1626750816953587.png&ehk=MLpXzPC3atCWwfdTqETM36XHkjfAwYmoYy%2ba013weZk%3d&risl=&pid=ImgRaw&r=0)
## 寻址方式
**CHS寻址**：CHS寻址模式通过三个参数来定位硬盘上的数据位置，即柱面（Cylinder）、磁头（Head）和扇区（Sector）。
- 柱面（Cylinder）：硬盘中所有盘片在同一半径下的磁道组合称为一个柱面。柱面是硬盘数据分区的基本单位。
- 磁头（Head）：负责读取和写入数据的电磁感应设备，每个盘片至少有一个磁头对应其读写面。
- 扇区（Sector）：磁盘上每个磁道被等分为若干个弧段，每个弧段称为一个扇区。每个扇区是硬盘上的最小物理存储单位，通常包含512字节或4096字节（即一个扇区的大小）。

**CHS寻址局限性**
- 容量限制：由于`CHS寻址方式中柱面数、磁头数和扇区数的取值范围有限`（例如，柱面数最大为1023，磁头数最大为255，扇区数最大为63），因此CHS寻址方式支持的硬盘容量有限。随着硬盘容量的不断增加，CHS寻址方式已经逐渐被更高效的寻址方式所取代。
- 访问效率：由于磁头需要在磁盘上物理移动来定位数据位置，因此CHS寻址方式的访问效率相对较低。特别是在处理大量小文件或随机访问时，性能瓶颈尤为明显。
# 为何要分区
**1.数据安全性**
>每个分区的数据是分开存储的，当要对某个分区的数据进行整理时，不会影响到其他分区例如对安装有Windows系统的C盘进行重装时，对其它分区如D盘、E盘中的数据不会产生影响

**2.提高读取速度**
> 某个分区处在特定范围的柱面范围内，当要在该分区读取数据时，只需要在其柱面内检索，由于数据较为集中，所有读取速度和性能较高
# 分区格式
## MBR
### 1.简介
>MBR分区格式中柱面是文件系统的最小单位，也就是分区的最小单位。
### 2.MBR分区结构
![alt text](https://img2018.cnblogs.com/blog/454642/201811/454642-20181130114421652-980329445.jpg)
> `MBR（Master Boot Record）`是主引导记录的缩写，它是硬盘上用于存储引导加载程序（bootloader）的一个特定区域，通常位于硬盘的`第一个扇区`（即扇区0，偏移量为0）。

**MBR共512字节大小，主要由三部分组成：**
- 1.`引导代码(Boot Code)`:用于在启动时加载操作系统,`占446字节`
- 2.`分区表(Partition Table)`:共64字节，每个分区表项16字节，MBR中的分区表项包含了硬盘上所有分区的信息，如分区的起始和结束扇区号、分区类型（如FAT32、NTFS、EXT4等）等。`MBR分区表支持最多4个主分区`，或者`3个主分区加上一个扩展分区`（扩展分区内可以包含多个逻辑分区）。
- 3.`结束标志`:MBR的最后两个字节通常是`0x55`,`0xAA`，这是一个特殊的标志，用于表示MBR的有效性和完整性。
### 3.扩展分区和逻辑分区
**扩展分区**
>扩展分区是一种特殊的主分区，它的主要作用是`作为一个容器，用于包含多个逻辑分区`。扩展分区`本身并不是一个可以直接使用的分区`，它只是一个指向下一个逻辑分区的指针结构。
- 在MBR分区表中，扩展分区的存在允许用户创建超过4个的分区，而无需受限于MBR分区表本身的限制
- 一个硬盘上最多只能有一个扩展分区。如果硬盘上已经有了4个主分区，那么就无法再创建扩展分区

**逻辑分区**
> 逻辑分区是建立在扩展分区内部的分区，它们可以被视为扩展分区的一部分。逻辑分区`可以包含文件系统和数据，就像主分区一样`。
- 每个逻辑分区都有一个与MBR结构类似的扩展引导记录（EBR），用于存储该逻辑分区的引导信息和分区信息。
- 逻辑分区的数量没有严格的限制，但通常会受到硬盘总容量、文件系统类型以及操作系统支持的限制。
- 在一个扩展分区内，可以创建任意数量的逻辑分区，以满足不同的存储需求。
### 4.MBR分区表的限制
**1.分区数量限制：**
- MBR分区表最多`只能支持4个主分区`，或者`3个主分区加上1个扩展分区`。扩展分区是一种特殊的主分区，它的主要作用是作为一个容器，用于包含多个逻辑分区。扩展分区本身并不是一个可以直接使用的分区，它只是一个指向下一个逻辑分区的指针结构。

**2.容量限制**
- MBR分区表使用32位来存储每个分区的扇区数量，单个分区的最多有`2^32-1个扇区`，每个扇区512字节，因此`单个分区容量最多约为2TB`
- 为了支持更大的硬盘容量和更多的分区数量，硬盘制造商和操作系统开发商引入了GPT
## GPT
### 1.简介
> 如今扇区大小不仅有512字节，还有4k大小的，为兼容所有的磁盘，使用逻辑区块地址(Logical Block Address)来处理扇区。
### 2.LBA介绍
#### (1)简介
> LBA是一种将硬盘等存储设备的物理地址映射为逻辑地址的技术，通过映射逻辑地址与物理地址的关系，使用户能够更方便地访问硬盘上的数据。
> LBA采用64位二进制数来表示。每一个LBA都可以唯一地标识一个扇区。一个分区的最大扇区数为2^64(从0计数)，足够将大容量的硬盘整个进行分区。

> 在传统的硬盘存储中，数据是以物理地址(`如CHS(Cylinder/Head/Sector)`寻址方式中的柱面、磁头和扇区)的形式存储的。CHS寻址模式通过三个参数来定位硬盘上的数据位置，即柱面（Cylinder）、磁头（Head）和扇区（Sector）
#### (2)工作原理:
- 1.**地址映射**：当操作系统或应用程序需要访问硬盘上的数据时，它们会提供逻辑地址(即LBA)。硬盘控制器或操作系统底层会将这个逻辑地址转换为对应的物理地址(即硬盘上的具体扇区位置和大小)
- 2.**数据访问**:转换完成后，硬盘控制器会根据物理地址来读取或写入数据。用户只需要通过逻辑地址来访问数据，无需关心数据在硬盘上的实际存储位置。
### 3.结构
>GPT将硬盘所有区块以LBA(默认512字节)来规划,第一个LBA称为LBA0

> 与MBR仅使用第一个512字节来记录不同，GPT使用了`34个LBA`来记录分区信息。相比于MBR只有一个区块记录分区信息。GPT除了前面34个LBA记录以外，整个磁盘的最后34个LBA也拿来做备份。

![alt text](https://pics5.baidu.com/feed/d62a6059252dd42a7c9fe55bede064bbcbeab892.png@f_auto?token=1da41261a6fc400057ac78343df4ac07)
**LBA**
- **LBA0(MBR兼容模块)**：出于兼容性考虑存储了一份传统MBR，用来防止不支持GPT的硬盘管理工具错误识别并破坏硬盘中的数据，这个MBR也叫做保护MBR。
分为两个部分，第一个是前面446字节，用来存储第一阶段的启动引导程序。而在原本的分区表的记录区内，这个兼容模式仅放入了一个特殊字符来表示此磁盘为GPT格式之意。
在使用 MBR/GPT 混合分区表的硬盘中，这部分存储了GPT分区表的一部分分区（通常是前四个分区），可以使不支持从GPT启动的操作系统从这个MBR启动，启动后只能操作MBR分区表中的分区。
- **LBA1(GPT表头记录)**：记录了`分区表本身的位置和大小，也记录了备份用的GPT分区（最后34个LBA区块）放置的位置。同时放置了分区表的校验码（CRC32）`，操作系统可以根据这个校验码来判断GPT是否正确。若有错误可以通过这个记录区来获取备份的GPT（磁盘最后面的备份区块）来恢复正常。
- **LBA`[2-33]`(实际记录分区信息处)**：从LBA2区块开始，每个LBA都可以`记录4组分区记录`，所以在默认情况下，总共有`4*32=128`组分区记录。每组记录用到128字节的空间。
- **GPT分区**：由分配给分区的扇区组成，这个区域的起始和结束地址由GPT头定义。
- **备份区域**：位于磁盘的尾部，包含GPT头和分区表的备份，用于在GPT头或分区表损坏时进行恢复。

